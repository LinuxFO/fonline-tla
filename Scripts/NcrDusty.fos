// FOS Server Sort 2
// Author: cvet
// Для квеста Вечеринка у Дасти.

///@ Property Game PrivateServer uint NcrDustyOneHourInvokeId
///@ Property Game PrivateServer uint NcrDustyOneWeekInvokeId
///@ Property Game PrivateServer uint8 NCRDustyPartyStatusGlobal Max = 2
///@ Property Game PrivateServer uint8 NCRDustyRotgutCounter     Max = 20
///@ Property Game PrivateServer uint8 NCRDustyBeerGammaCounter  Max = 20

void _DustyInit(Critter dusty, bool firstTime)
{
    dusty.IsNoBarter = false;
    dusty.IsNoSteal = true;
    dusty.TalkDistance = 5;
    __EventCritterFinish.SubscribeToCritter(dusty, _DustyFinish);
    if (firstTime) {
        GameInstance.NcrDustyOneHourInvokeId = SavedDeferredCall(GAME_HOUR_TO_TICK(1), OneHour);
        GameInstance.NcrDustyOneWeekInvokeId = SavedDeferredCall(GAME_DAY_TO_TICK(7), OneWeek);
    }
}

void _DustyFinish(Critter dusty)
{
    CancelDeferredCall(GameInstance.NcrDustyOneHourInvokeId);
    GameInstance.NcrDustyOneHourInvokeId = 0;
    CancelDeferredCall(GameInstance.NcrDustyOneWeekInvokeId);
    GameInstance.NcrDustyOneWeekInvokeId = 0;
}

void OneHour()
{
    if (GameInstance.NCRDustyRotgutCounter >= 20 && GameInstance.NCRDustyBeerGammaCounter >= 20)
        GameInstance.NCRDustyPartyStatusGlobal = 2;
    GameInstance.NcrDustyOneHourInvokeId = SavedDeferredCall(GAME_HOUR_TO_TICK(1), OneHour);
}

void OneWeek()
{
    GameInstance.NCRDustyRotgutCounter = 0;
    GameInstance.NCRDustyBeerGammaCounter = 0;
    GameInstance.NCRDustyPartyStatusGlobal = 0;
    GameInstance.NcrDustyOneWeekInvokeId = SavedDeferredCall(GAME_DAY_TO_TICK(7), OneWeek);
}
